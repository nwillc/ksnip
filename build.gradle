buildscript {
    repositories {
        jcenter()
        maven {
            url 'https://plugins.gradle.org/m2/'
        }
    }
    dependencies {
        classpath "org.jetbrains.kotlin:kotlin-gradle-plugin:$kotlin_version",
                "gradle.plugin.com.github.nwillc:vplugin:$vplugin_version"
    }
}

group 'com.github.nwillc'
version '1.0-SNAPSHOT'

apply plugin: 'kotlin'
apply plugin: 'com.github.nwillc.vplugin'

repositories {
    jcenter()
}

dependencies {
    compile "org.jetbrains.kotlin:kotlin-stdlib-jdk8:$kotlin_version",
            "no.tornado:tornadofx:$tornadofx_version",
            "com.fasterxml.jackson.module:jackson-module-kotlin:$jackson_version"

    testCompile "org.junit.jupiter:junit-jupiter-engine:$jupiter_version",
            "org.junit.platform:junit-platform-runner:$junit_platform_version",
            "org.assertj:assertj-core:$assertj_version"
}

compileKotlin {
    kotlinOptions.jvmTarget = jvm_version
}

compileTestKotlin {
    kotlinOptions.jvmTarget = jvm_version
}

jar {
    manifest {
        attributes 'Main-Class': 'com.github.nwillc.ksnip.app.SnippetsApp'
    }

    from { configurations.compile.collect { it.isDirectory() ? it : zipTree(it) } }
}

task appBundle(type: Copy) {
    println("Creating App Bundle")

    mkdir("KSnip.app")
    mkdir("KSnip.app/Contents")
    mkdir("KSnip.app/Contents/MacOS")
    mkdir("KSnip.app/Contents/Resources")

    ant.copy file: "src/main/app/Info.plist",
            todir: "KSnip.app/Contents"

    ant.copy file: "src/main/app/launcher",
            todir: "KSnip.app/Contents/MacOS"

    ant.copy file: "src/main/app/application.icns",
            todir: "KSnip.app/Contents/Resources"

    ant.copy file: "build/libs/KSnip-${version}.jar",
            todir: "KSnip.app/Contents/MacOS"
}